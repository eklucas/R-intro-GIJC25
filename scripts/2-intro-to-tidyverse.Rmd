---
title: "Introduction to the Tidyverse"
output:
  html_document:
    df_print: paged
---

The main functions of the tidyverse that we're going to cover are these:

-   select()
-   filter()
-   arrange()
-   group_by()
-   summarise()

Refer to R-Functions.html for an explanation of these functions and examples.

Here's we'll put these functions into practice using the UN literacy data.
Always start your scripts by loading the necessary libraries and the data:
```{r}
library(tidyverse)

literacy <- read_csv("data/UN_literacy.csv")
```

Our goal here is to demo the functions mentioned above, so you get a sense for what each one does. We won't explore their full capability here, just a brief demonstration.

An important note: the tidyverse works with a *pipe* which is this character `%>%`. It does what it sounds like: it sends the results of one function into the next. When asking questions of data, always start with the variable name that holds your dataset and pipe it into the function(s) that help you answer your question.

### select()

Use `select()` to choose only particular columns from your data table, or to exclude columns in your results:

```{r}
literacy %>% select(year, country_or_area, sex, age, total)
```

Use the negative sign to exclude columns:

```{r}
literacy %>% select(-unknown)
```

### filter()

Use `filter()` to subset records from your data table, such as all the counties in a single state. For example, if you only want to see counties in California:

```{r}
literacy %>% filter(area=="Urban")
```

Note the double equals sign, which is how R tests for sameness (whereas one equals sign assigns something to a variable, or container).

You can specify multiple criteria in your filter, separated by `&` (and) or `|` (or):

```{r}
literacy %>% filter(area=="Urban" & sex == "Male")

# note that numbers don't need double quotes:
literacy %>% filter(total > 1000000)
```

```{r}
literacy %>% filter(country_or_area=="Greece" | country_or_area=="Bulgaria" | country_or_area=="North Macedonia")
# or...
literacy %>% filter(country_or_area %in% c("Greece", "Bulgaria", "North Macedonia"))
```

### arrange()

Use `arrange()` to sort your data.

```{r}
literacy %>% arrange(total)
```

The default is ascending, so to switch to descending, use the function `desc()` like this:

```{r}
literacy %>% arrange(desc(total))
```

You can do a multi-level sort:

```{r}
literacy %>% arrange(country_or_area, desc(literate))
```

### summarise()

Use summarise() to apply summary functions to a column in your data. Note that since the tidyverse was primarily written by a New Zealander you'll often see summarise spelled with an s, but you can also spell it with a z.

To sum up any column using the tidyverse convention of piping, you need to put the `sum()` function inside the `summarise()` function:

```{r}
literacy %>%  summarise(total_pop = sum(total))
```
Note: this is not actually a helpful number because in our dataset there is a cagetory in "age" that overlaps others: 10 +. So we need to account for that to get a real number. 

To do that, we'll use both `filter()` and `summarise()`. Piping allows you to string functions together:

```{r}
literacy %>% 
  filter(age == "10 +") %>% 
  summarise(total_pop = sum(total))
```

Within `summarise()` you can apply any number of summary functions beyond `sum()`.

See R-Functions.html for some other summary functions you can use.

### group_by()

Use `group_by()` to apply summary functions to groups rather than the whole (or filtered) dataset.

`group_by()` puts your rows into groups based on the values in some column, whatever you specify within the function. So if you want to group all the rows by state and add up the population for each:

```{r}
# What is the total population (age 10 +) for each country? 
literacy %>% 
  filter(age == "10 +") %>% 
  group_by(country_or_area) %>% 
  summarise(total_pop = sum(total))
```

Add the `arrange()` function to sort by total population:

```{r}
literacy %>% 
  filter(age == "10 +") %>% 
  group_by(country_or_area) %>% 
  summarise(total_pop = sum(total)) %>% 
  arrange(desc(total_pop))
```

Note: because you named the result of sum(total) "total_pop", you can feed that into the `arrange()` function. If you hadn't named it, you could not sort by that column.

